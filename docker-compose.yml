
version: '3.7'
services:
  
  #############################################################################################
  ###                               DPS service API                                         ###
  #############################################################################################
  service-api:
    image: nginx:latest
    volumes:
      - ./src/service-api/conf/nginx.conf:/etc/nginx/nginx.conf
    ports:
      - 5000:80
    networks:
      - dps-net

  #############################################################################################
  ###                               DPS payment service                                     ###
  #############################################################################################
  payment-service:
    build:
      context: ./src/paymentservice
    environment: 
      - spring_profiles_active=cloud,splunk
      - BAMBORA_PAYMENT_ENDPOINT=https://example.com
      - BAMBORA_MERCHANT_ID=changeme
      - BAMBORA_HASHKEY=SUPERHASHKEY
      - CRC_ENDPOINT_APPROVED=http://approved
      - CRC_ENDPOINT_DECLINED=http://declined
      - CRC_ENDPOINT_ERROR=http://error
      - SPLUNK_URL=https://dps-splunk:8088
      - SPLUNK_TOKEN=${SPLUNK_TOKEN}
    ports:
      - "8081"
    networks:
      - dps-net

  #############################################################################################
  ###                                 SPLUNK DEV BOX                                        ###
  #############################################################################################
  dps-splunk:
    image: splunk/splunk:7.3.2
    environment:
      - SPLUNK_PASSWORD=admin123!
      - SPLUNK_START_ARGS=--accept-license
    ports:
      - "8000:8000"
      - "8001:8001"
      - "8088:8088"
      - "8089:8089"
    networks:
      - dps-net

networks: 
  dps-net:
    driver: "bridge"
